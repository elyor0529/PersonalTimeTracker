version: 1.0.{build}
clone_folder: c:\gopath\src\acs560_course_project
clone_depth: 1
environment:
  GOPATH: c:\gopath
services:
  - postgresql101
cache:
- client\TimeTracker\packages -> **\packages.config
install:
- nuget restore %APPVEYOR_BUILD_FOLDER%\client\TimeTracker\TimeTracker\packages.config -OutputDirectory %APPVEYOR_BUILD_FOLDER%\client\TimeTracker\packages
before_build:
- go get github.com/jinzhu/gorm
- go get github.com/go-sql-driver/mysql
- go get github.com/lib/pq
- SET PGUSER=postgres
- SET PGPASSWORD=Password12!
- SET acs_database=postgres
- SET acs_dbuser=postgres
- SET acs_dbpass=Password12!
- SET acs_onlineDbNameTest=sandboxtest
- SET acs_onlineDbName=sandbox
- SET acs_hostname=127.0.0.1
- SET acs_hostport=5432
- PATH=C:\Program Files\PostgreSQL\9.6\bin\;%PATH%
- createdb sandboxtest
- createdb sandbox
- ps: Invoke-WebRequest "https://dl.dropbox.com/s/s0d3a8y97aznbic/sandbox.sql" -OutFile sandbox.sql
- psql -a -f sandbox.sql
- cd %APPVEYOR_BUILD_FOLDER%\server && go test .\... && go build
- cd %APPVEYOR_BUILD_FOLDER%\client\TimeTracker\TimeTracker
- copy %APPVEYOR_BUILD_FOLDER%\server\server.exe %APPVEYOR_BUILD_FOLDER%\client\TimeTracker
- dir %APPVEYOR_BUILD_FOLDER%\client\TimeTracker
build:
  verbosity: minimal
test_script:
- cmd: nunit3-console --where "namespace==TimeTracker" bin\Debug\TimeTracker.exe